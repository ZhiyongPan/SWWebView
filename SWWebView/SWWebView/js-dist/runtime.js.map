{"version":3,"file":"runtime.js","sources":["../../js-src/src/fetch-graft.ts","../../js-src/node_modules/tiny-emitter/index.js","../../js-src/src/util/streaming-xhr.ts","../../js-src/src/util/full-api-url.ts","../../js-src/src/event-stream.ts","../../js-src/src/util/api-request.ts","../../js-src/src/components/service-worker.ts","../../js-src/src/components/service-worker-registration.ts","../../js-src/src/components/service-worker-container.ts"],"sourcesContent":["import { SW_PROTOCOL, GRAFTED_REQUEST_HEADER } from \"swwebview-settings\";\n\n// We can't read POST bodies in native code, so we're doing the super-gross:\n// putting it in a custom header. Hoping we can get rid of this nonsense soon.\n\nconst originalFetch = fetch;\n\nfunction graftedFetch(request: RequestInfo, opts?: RequestInit) {\n    if (!opts || !opts.body) {\n        // no body, so none of this matters\n        return originalFetch(request, opts);\n    }\n\n    let url = request instanceof Request ? request.url : request;\n    let resolvedURL = new URL(url, window.location.href);\n\n    if (resolvedURL.protocol !== SW_PROTOCOL + \":\") {\n        // if we're not fetching on the SW protocol, then this\n        // doesn't matter.\n        return originalFetch(request, opts);\n    }\n\n    opts.headers = opts.headers || {};\n    opts.headers[GRAFTED_REQUEST_HEADER] = opts.body;\n\n    return originalFetch(request, opts);\n}\n\n(graftedFetch as any).__bodyGrafted = true;\n\nif ((originalFetch as any).__bodyGrafted !== true) {\n    (window as any).fetch = graftedFetch;\n\n    const originalSend = XMLHttpRequest.prototype.send;\n    const originalOpen = XMLHttpRequest.prototype.open;\n\n    XMLHttpRequest.prototype.open = function(method, url) {\n        let resolvedURL = new URL(url, window.location.href);\n        if (resolvedURL.protocol === SW_PROTOCOL + \":\") {\n            this._graftBody = true;\n        }\n        originalOpen.apply(this, arguments);\n    };\n\n    XMLHttpRequest.prototype.send = function(data) {\n        if (data && this._graftBody === true) {\n            this.setRequestHeader(GRAFTED_REQUEST_HEADER, data);\n        }\n        originalSend.apply(this, arguments);\n    };\n}\n","function E() {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function(name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function(name, callback, ctx) {\n    var self = this;\n    function listener() {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    }\n\n    listener._ = callback;\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function(name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  dispatchEvent: function(ev) {\n    var name = ev.type;\n    this.emit(name, ev);\n  },\n\n  off: function(name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    liveEvents.length ? (e[name] = liveEvents) : delete e[name];\n\n    return this;\n  }\n};\n\nE.prototype.addEventListener = E.prototype.on;\nE.prototype.removeEventListener = E.prototype.off;\n\nmodule.exports = E;\n","import EventEmitter from \"tiny-emitter\";\nimport { API_REQUEST_METHOD } from \"swwebview-settings\";\n\ninterface CustomMessageEvent<T> extends MessageEvent {\n    data: T;\n}\n\nexport class StreamingXHR extends EventEmitter {\n    private xhr: XMLHttpRequest;\n    private seenBytes = 0;\n    private isOpen = false;\n    private url: string;\n\n    constructor(url: string) {\n        super();\n        this.url = url;\n    }\n\n    open() {\n        if (this.isOpen === true) {\n            throw new Error(\"Already open\");\n        }\n        this.isOpen = true;\n        this.xhr = new XMLHttpRequest();\n\n        this.xhr.open(API_REQUEST_METHOD, this.url);\n        this.xhr.onreadystatechange = this.receiveData.bind(this);\n        this.xhr.send();\n    }\n\n    addEventListener<T>(\n        type: string,\n        func: (e: CustomMessageEvent<T>) => void\n    ) {\n        super.addEventListener(type, func);\n    }\n\n    receiveData() {\n        // try {\n        if (this.xhr.readyState !== 3) {\n            return;\n        }\n\n        // This means the responseText keeps growing and growing. Perhaps\n        // we should look into cutting this off and re-establishing a new\n        // link if it gets too big.\n        let newData = this.xhr.responseText.substr(this.seenBytes);\n\n        this.seenBytes = this.xhr.responseText.length;\n        let [_, event, data] = /([\\w\\-]+):(.*)/.exec(newData)!;\n        let evt = new MessageEvent(event, {\n            data: JSON.parse(data)\n        });\n        // console.info(\"EVENT:\", event, evt.data);\n        this.dispatchEvent(evt);\n        // } catch (err) {\n        //     console.error(err);\n        //     let errEvt = new ErrorEvent(\"error\", {\n        //         error: err\n        //     });\n        //     this.dispatchEvent(errEvt);\n        // }\n    }\n\n    close() {\n        this.xhr.abort();\n    }\n}\n","import { SW_PROTOCOL, SW_API_HOST } from \"swwebview-settings\";\n\nexport function getFullAPIURL(path) {\n    return new URL(path, SW_PROTOCOL + \"://\" + SW_API_HOST).href;\n}\n","import { StreamingXHR } from \"./util/streaming-xhr\";\nimport { getFullAPIURL } from \"./util/full-api-url\";\n\nlet absoluteURL = getFullAPIURL(\"/events\");\nlet eventsURL = new URL(absoluteURL);\neventsURL.searchParams.append(\"path\", window.location.pathname);\n\nexport const eventStream = new StreamingXHR(eventsURL.href);\n","import { API_REQUEST_METHOD } from \"swwebview-settings\";\nimport { getFullAPIURL } from \"./full-api-url\";\nexport class APIError extends Error {\n    response: Response;\n\n    constructor(message: string, response: Response) {\n        super(message);\n        this.response = response;\n    }\n}\n\nexport function apiRequest<T>(path: string, body: any = undefined): Promise<T> {\n    return fetch(getFullAPIURL(path), {\n        method: API_REQUEST_METHOD,\n        body: body === undefined ? undefined : JSON.stringify(body),\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    }).then(res => {\n        if (res.ok === false) {\n            if (res.status === 500) {\n                return res.json().then(errorJSON => {\n                    throw new Error(errorJSON.error);\n                });\n            }\n            throw new APIError(\n                \"Received a non-200 response to API request\",\n                res\n            );\n        }\n        return res.json();\n    });\n}\n","import EventEmitter from \"tiny-emitter\";\nimport { ServiceWorkerAPIResponse } from \"../responses/api-responses\";\n\nconst existingWorkers: ServiceWorkerImplementation[] = [];\n\nexport class ServiceWorkerImplementation extends EventEmitter\n    implements ServiceWorker {\n    id: string;\n    scriptURL: string;\n    state: ServiceWorkerState;\n    onstatechange: () => void;\n    onerror: (Error) => void;\n\n    constructor(opts: ServiceWorkerAPIResponse) {\n        super();\n        this.scriptURL = opts.scriptURL;\n        this.id = opts.id;\n        this.state = opts.installState;\n    }\n\n    postMessage() {}\n\n    static getOrCreate(opts: ServiceWorkerAPIResponse) {\n        let existing = existingWorkers.find(w => w.id === opts.id);\n        if (existing) {\n            return existing;\n        } else {\n            let newWorker = new ServiceWorkerImplementation(opts);\n            existingWorkers.push(newWorker);\n            return newWorker;\n        }\n    }\n}\n","import EventEmitter from \"tiny-emitter\";\nimport { ServiceWorkerRegistrationAPIResponse } from \"../responses/api-responses\";\nimport { apiRequest } from \"../util/api-request\";\nimport { BooleanSuccessResponse } from \"../responses/api-responses\";\nimport { eventStream } from \"../event-stream\";\nimport { ServiceWorkerImplementation } from \"./service-worker\";\n\nconst existingRegistrations: ServiceWorkerRegistrationImplementation[] = [];\n\nexport class ServiceWorkerRegistrationImplementation extends EventEmitter\n    implements ServiceWorkerRegistration {\n    active: ServiceWorker | null;\n    installing: ServiceWorker | null;\n    waiting: ServiceWorker | null;\n\n    pushManager: PushManager;\n    scope: string;\n    id: string;\n    sync: SyncManager;\n\n    constructor(opts: ServiceWorkerRegistrationAPIResponse) {\n        super();\n        this.scope = opts.scope;\n        this.id = opts.id;\n        this.updateFromResponse(opts);\n    }\n\n    static getOrCreate(opts: ServiceWorkerRegistrationAPIResponse) {\n        let registration = existingRegistrations.find(reg => reg.id == opts.id);\n        if (!registration) {\n            if (opts.unregistered === true) {\n                throw new Error(\n                    \"Trying to create an unregistered registration\"\n                );\n            }\n            console.info(\"Creating new registration:\", opts.id, opts);\n            registration = new ServiceWorkerRegistrationImplementation(opts);\n            existingRegistrations.push(registration);\n        }\n        return registration;\n    }\n\n    updateFromResponse(opts: ServiceWorkerRegistrationAPIResponse) {\n        if (opts.unregistered === true) {\n            console.info(\"Removing inactive registration:\", opts.id);\n            // Remove from our array of existing registrations, as we don't\n            // want to refer to this again.\n            let idx = existingRegistrations.indexOf(this);\n            existingRegistrations.splice(idx, 1);\n            return;\n        }\n\n        this.active = opts.active\n            ? ServiceWorkerImplementation.getOrCreate(opts.active)\n            : null;\n        this.installing = opts.installing\n            ? ServiceWorkerImplementation.getOrCreate(opts.installing)\n            : null;\n        this.waiting = opts.waiting\n            ? ServiceWorkerImplementation.getOrCreate(opts.waiting)\n            : null;\n    }\n\n    onupdatefound: () => void;\n\n    getNotifications() {\n        throw new Error(\"not yet\");\n    }\n\n    showNotification(\n        title: string,\n        options?: NotificationOptions\n    ): Promise<void> {\n        throw new Error(\"not yet\");\n    }\n\n    unregister(): Promise<boolean> {\n        return apiRequest<\n            BooleanSuccessResponse\n        >(\"/ServiceWorkerRegistration/unregister\", {\n            id: this.id\n        }).then(response => {\n            return response.success;\n        });\n    }\n\n    update(): Promise<void> {\n        throw new Error(\"not yet\");\n    }\n}\n\neventStream.addEventListener<\n    ServiceWorkerRegistrationAPIResponse\n>(\"serviceworkerregistration\", e => {\n    console.log(e);\n    let reg = existingRegistrations.find(r => r.id == e.data.id);\n    if (reg) {\n        reg.updateFromResponse(e.data);\n    } else {\n        console.info(\n            \"Received update for non-existent registration\",\n            e.data.id\n        );\n    }\n});\n","import EventEmitter from \"tiny-emitter\";\nimport { eventStream } from \"../event-stream\";\nimport { apiRequest } from \"../util/api-request\";\nimport {\n    ServiceWorkerRegistrationAPIResponse,\n    ServiceWorkerContainerAPIResponse\n} from \"../responses/api-responses\";\nimport { ServiceWorkerRegistrationImplementation } from \"../components/service-worker-registration\";\nimport { ServiceWorkerImplementation } from \"./service-worker\";\n\nclass ServiceWorkerContainerImplementation extends EventEmitter\n    implements ServiceWorkerContainer {\n    // used for detection\n    static __isSWWebViewImplementation = true;\n\n    controller: ServiceWorker;\n    oncontrollerchange: (ev: Event) => void;\n    onmessage: (ev: Event) => void;\n    ready: Promise<ServiceWorkerRegistration>;\n\n    location: Location;\n\n    constructor() {\n        console.info(\n            \"Created new ServiceWorkerContainer for\",\n            window.location.pathname\n        );\n        super();\n        this.location = window.location;\n\n        (this as any).controller = null;\n\n        let readyFulfill: ((ServiceWorkerRegistration) => void) | undefined;\n        this.ready = new Promise((fulfill, reject) => {\n            readyFulfill = fulfill;\n        });\n\n        this.addEventListener(\"controllerchange\", e => {\n            if (this.oncontrollerchange) {\n                this.oncontrollerchange(e);\n            }\n        });\n\n        eventStream.addEventListener<\n            ServiceWorkerContainerAPIResponse\n        >(\"serviceworkercontainer\", e => {\n            console.info(\"container change\", e.data);\n            let reg = e.data.readyRegistration\n                ? ServiceWorkerRegistrationImplementation.getOrCreate(\n                      e.data.readyRegistration\n                  )\n                : undefined;\n\n            console.log(\"container response\", e.data, reg);\n\n            if (reg && readyFulfill) {\n                console.log(\"fulfill existing pending\");\n                readyFulfill!(reg);\n                readyFulfill = undefined;\n            } else if (reg) {\n                console.log(\"set new resolved promise\");\n                this.ready = Promise.resolve(reg);\n            } else if (!readyFulfill) {\n                console.log(\"set empty promise\");\n                this.ready = new Promise((fulfill, reject) => {\n                    readyFulfill = fulfill;\n                });\n            }\n\n            let newControllerInstance: ServiceWorker | null;\n\n            if (e.data.controller) {\n                newControllerInstance = ServiceWorkerImplementation.getOrCreate(\n                    e.data.controller\n                );\n            } else {\n                newControllerInstance = null;\n            }\n\n            if (newControllerInstance !== this.controller) {\n                console.info(\n                    \"Set new controller from\",\n                    this.controller,\n                    \"to\",\n                    newControllerInstance\n                );\n                // Have to do 'as any' because TypeScript definition doesn't\n                // allow null service workers\n                (this as any).controller = newControllerInstance;\n                let evt = new CustomEvent(\"controllerchange\");\n                this.dispatchEvent(evt);\n            }\n        });\n        eventStream.open();\n    }\n\n    controllerChangeMessage(evt: MessageEvent) {\n        console.log(evt);\n    }\n\n    getRegistration(\n        scope?: string\n    ): Promise<ServiceWorkerRegistration | undefined> {\n        return apiRequest<ServiceWorkerRegistrationAPIResponse | null>(\n            \"/ServiceWorkerContainer/getregistration\",\n            {\n                path: window.location.pathname,\n                scope: scope\n            }\n        ).then(response => {\n            if (response === null) {\n                return undefined;\n            }\n            return ServiceWorkerRegistrationImplementation.getOrCreate(\n                response\n            );\n        });\n    }\n\n    getRegistrations(): Promise<ServiceWorkerRegistration[]> {\n        return apiRequest<\n            [ServiceWorkerRegistrationAPIResponse]\n        >(\"/ServiceWorkerContainer/getregistrations\", {\n            path: window.location.pathname\n        }).then(response => {\n            let registrations: ServiceWorkerRegistration[] = [];\n\n            response.forEach(r => {\n                if (r) {\n                    registrations.push(\n                        ServiceWorkerRegistrationImplementation.getOrCreate(r)\n                    );\n                }\n            });\n\n            return registrations;\n        });\n    }\n\n    register(\n        url: string,\n        opts?: RegistrationOptions\n    ): Promise<ServiceWorkerRegistration> {\n        console.info(\"Registering new worker at:\", url);\n        return apiRequest<\n            ServiceWorkerRegistrationAPIResponse\n        >(\"/ServiceWorkerContainer/register\", {\n            path: window.location.pathname,\n            url: url,\n            scope: opts ? opts!.scope : undefined\n        }).then(response => {\n            return ServiceWorkerRegistrationImplementation.getOrCreate(\n                response\n            );\n        });\n    }\n}\nif (\"ServiceWorkerContainer\" in self === false) {\n    // We lazily initialize this when the client code requests it.\n    let container: ServiceWorkerContainerImplementation | undefined = undefined;\n\n    Object.defineProperty(navigator, \"serviceWorker\", {\n        configurable: true,\n        get() {\n            if (container) {\n                return container;\n            }\n            return (container = new ServiceWorkerContainerImplementation());\n        }\n    });\n}\n"],"names":["SW_PROTOCOL","GRAFTED_REQUEST_HEADER","API_REQUEST_METHOD","EventEmitter","SW_API_HOST"],"mappings":"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"}